require 'minitest/autorun'
require 'minitest/assertions'

require './battle'

class RedditTests < Minitest::Test
  def test_step_by_step_1
    # test input and steps by https://www.reddit.com/r/adventofcode/comments/a7b8k6/day_15_part_1_kotlin_still_cant_figure_out_what/ec1zjvy/

    input = <<~EOF
      ################################
      #######.G...####################
      #########...####################
      #########.G.####################
      #########.######################
      #########.######################
      #########G######################
      #########.#...##################
      #########.....#..###############
      ########...G....###.....########
      #######............G....########
      #######G....G.....G....#########
      ######..G.....#####..G...#######
      ######...G...#######......######
      #####.......#########....G..E###
      #####.####..#########G...#....##
      ####..####..#########..G....E..#
      #####.####G.#########...E...E.##
      #########.E.#########.........##
      #####........#######.E........##
      ######........#####...##...#..##
      ###...................####.##.##
      ###.............#########..#####
      #G#.#.....E.....#########..#####
      #...#...#......##########.######
      #.G............#########.E#E####
      #..............##########...####
      ##..#..........##########.E#####
      #..#G..G......###########.######
      #.G.#..........#################
      #...#..#.......#################
      ################################
    EOF

    battle = Battle.new(input)

    battle.tick!

    round_1_grid = <<~EOF
      ################################
      #######.G...####################
      #########...####################
      #########.G.####################
      #########.######################
      #########.######################
      #########.######################
      #########G#...##################
      #########.....#..###############
      ########........###.....########
      #######....G........G...########
      #######.G..G.......G...#########
      ######...G....#####...G..#######
      ######....G..#######......######
      #####.......#########.....GE.###
      #####.####..#########....#..E.##
      ####..####..#########G..G...E..#
      #####.####G.#########...E.....##
      #########.E.#########E........##
      #####........#######..........##
      ######........#####...##...#..##
      ###...................####.##.##
      ###.......E.....#########..#####
      #.#.#...........#########..#####
      #GG.#...#......##########E######
      #..............#########..#E####
      #..............##########...####
      ##..#..G.......##########.E#####
      #.G#.G........###########.######
      #...#..........#################
      #...#..#.......#################
      ################################
    EOF

    assert_equal(round_1_grid.strip, battle.to_s)





    round_2_grid = <<~EOF
      ################################
      #######.G...####################
      #########...####################
      #########.G.####################
      #########.######################
      #########.######################
      #########.######################
      #########.#...##################
      #########G....#..###############
      ########........###.....########
      #######...G..........G..########
      #######..G..........G..#########
      ######.....G..#####......#######
      ######...G.G.#######..G...######
      #####.......#########.....GE.###
      #####.####..#########....#.E..##
      ####..####..#########...G..E...#
      #####.####G.#########G..E.....##
      #########.E.#########E........##
      #####........#######..........##
      ######........#####...##...#..##
      ###.......E...........####.##.##
      ###.............#########..#####
      #.#.#...........#########E.#####
      #..G#...#......##########.######
      #G.............#########..#E####
      #......G.......##########...####
      ##G.#G.........##########.E#####
      #..#..........###########.######
      #...#..........#################
      #...#..#.......#################
      ################################
    EOF

    battle.tick!
    assert_equal(round_2_grid.strip, battle.to_s)


    round_20_grid = <<~EOF
      ################################
      #######..G..####################
      #########...####################
      #########...####################
      #########.######################
      #########.######################
      #########G######################
      #########.#...##################
      #########....G#..###############
      ########........###.....########
      #######.................########
      #######...GGGG.........#########
      ######........#####......#######
      ######.......#######......######
      #####.......#########.....GE.###
      #####.####..#########....#E...##
      ####..####..#########G..GE.....#
      #####.####GG#########G.GE.....##
      #########GEE#########EGE......##
      #####.....GG.#######..E.......##
      ######........#####...##...#..##
      ###...........G.......####.##.##
      ###.........G...#########..#####
      #.#.#...........#########..#####
      #...#...#......##########.######
      #..............#########.E#.####
      #..............##########...####
      ##..#..........##########..#####
      #..#..........###########.######
      #...#..........#################
      #...#..#.......#################
      ################################
    EOF

    until battle.round == 20
      battle.tick!
    end

    assert_equal(round_20_grid.strip, battle.to_s)


    round_66_grid = <<~EOF
      ################################
      #######.....####################
      #########...####################
      #########...####################
      #########.######################
      #########.######################
      #########.######################
      #########.#...##################
      #########..G..#..###############
      ########........###.....########
      #######.........G.G.....########
      #######........G.......#########
      ######....GG..#####...G..#######
      ######.......#######....G.######
      #####.......#########..GE....###
      #####.####..#########..GE#....##
      ####..####..#########.GE.......#
      #####.####GG#########..G......##
      #########...#########.GE......##
      #####........#######.GE.......##
      ######........#####...##...#..##
      ###...........G.......####.##.##
      ###.............#########..#####
      #.#.#...........#########..#####
      #...#...#......##########.######
      #..............#########..#.####
      #..............##########...####
      ##..#..........##########..#####
      #..#..........###########.######
      #...#..........#################
      #...#..#.......#################
      ################################
    EOF

    until battle.round == 66
      battle.tick!
    end
    assert_equal(round_66_grid.strip, battle.to_s)


  end
end


__END__








    G[0]{11,8}(200)

    G[8]{16,10}(200) G[1]{18,10}(200)
    G[16]{15,11}(110)
    G[28]{10,12}(200) G[10]{11,12}(98) G[3]{22,12}(200)
    G[2]{24,13}(200)
    G[7]{23,14}(68) E[15]{24,14}(128)
    G[5]{23,15}(176) E[25]{24,15}(200)
    G[13]{22,16}(29) E[18]{23,16}(77)
    G[23]{10,17}(200) G[27]{11,17}(200) G[6]{23,17}(200)
    G[4]{22,18}(29) E[24]{23,18}(38)
    G[29]{21,19}(200) E[26]{22,19}(107)

    G[21]{14,21}(200)











